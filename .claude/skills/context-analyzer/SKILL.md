---
name: context-analyzer
description: Parse context.json graph, rerank, consolidate, detect patterns
category: core
type: implementation
version: 1.0.0
---

## Concept

Parse context.json et produit synthèse intelligente. Construire graph mémoire, score importance, détecter patterns, consolider état.

## Algorithme Principal

### 1. Parse Graph
- Lire entries avec relations (links, supersedes)
- Construire graph en mémoire (json structure)

### 2. Compute Importance Score
```
importance = (
  recency_score * 0.4 +     # Plus récent = plus important
  impact_count * 0.3 +       # Plus d'impacts = plus important
  links_count * 0.2 +        # Plus de liens = plus central
  type_weight * 0.1          # decision > action > note
)

type_weight = {
  "decision": 1.0,
  "pattern": 0.9,
  "action": 0.7,
  "note": 0.5
}
```

### 3. Group by Theme
- Regrouper entries par field "theme"
- Détecter patterns récurrents (tags similaires)
- Rank par importance

### 4. Filter Obsolete
- Ignorer entries avec status="obsolete"
- Remplacer par supersedes si existe
- Keep linéage

### 5. Consolidate Duplicates
- Fusionner doublons (même theme + tags similaires)
- Garder le plus récent/important
- Merge links

## Output Structure

```markdown
# SYNTHÈSE CONTEXTE
[Generated: timestamp]

## Patterns Établis (Immuables)
### CEO Proactif
[Top patterns que règles jamais violer]
- Pattern 1 + justification
- Pattern 2 + justification

### Conventions
[Style/approches non-négociables]

## Décisions Actives (Par Thème)
### Architecture
[Top 5-10 décisions architecture actuelles]
- Decision: [titre], Status: [active/pending/blocked], Impact: [lié à X]

### Workflow
[Top 5-10 décisions workflow actuelles]

### Technical
[Top 5-10 décisions techniques]

## Préférences User
### Communication
[Style préféré, tone, format]

### Development
[Langages, frameworks, patterns préférés]

## État Actuel
### Delta (vs dernière synthèse)
- Agents créés/modifiés: [count]
- Décisions prises: [count]
- Blockers résolus: [count]
- New warnings: [count]

### Critical Status
[Si blockers actifs ou warnings]

## Warnings & Conflits
[Si détectés - conflicts entre décisions, patterns violés, etc]

---
Generated by context-analyzer v1.0.0
```

## Usage Pattern

```python
# 1. Load context.json
context = read(".claude/data/brain/context.json")

# 2. Parse + score + consolidate
analysis = context_analyzer.analyze(context)

# 3. Generate markdown synthèse
synthese = analysis.to_markdown()

# 4. Return à orchestrator
return synthese
```

## Best Practices

- **Top N par thème**: Limiter à 10 entries max par catégorie (recency + importance)
- **Patterns = immutables**: Afficher en haut, jamais violer
- **Préférences = style**: Communication, development preferences
- **État = delta**: Show what changed vs last synthesis (agents, decisions, blockers)
- **Warnings = actionnable**: Uniquement conflits réels/patterns violés
- **Timestamps**: All entries with [Date YYYY-MM-DD] format
- **Impact liens**: Show connections (entry X impacts Y)

## Detection Rules

### Pattern Recognition
- Même tag >2x = pattern établi
- Même theme >5 entries = décision établie
- Links >3 = élément central

### Obsolete Detection
- status="obsolete" → ignore
- supersedes field → show replacement
- Date >90 jours + status="blocked" → flag warning

### Conflict Detection
- Deux décisions theme=X contradictoires → warning
- Pattern violé par action récente → warning
- Blocker actif >7 jours → warning

## Implementation Notes

- Parsing: JSON structure avec relations
- Scoring: Calcul numérique (recency, impact, links, type)
- Consolidation: Merge doublons par (theme, tags similaires)
- Output: Markdown synthèse, max 200 lignes
- No external APIs: Tout en local
